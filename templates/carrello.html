{% extends "layout.html" %}

{% block title %}Librochiocciola{% endblock %}

{% block head %}
<script>
function eliminalibrocarr(isbn){
    r = confirm("Sicuro di voler rimuovere il libro dal carrello?");
    if (r == true) {
        window.location = '/remlibcar/' + isbn;
    }
}
</script>
{% endblock %}

{% block menu %}
{% include '/buttons/goback.html' %}
{%if session['usertype'] == 1%}
{% include '/buttons/visprofilo.html' %}
{%endif%}
{% include '/buttons/loginout.html' %}
{% endblock %}

{% block body %}
{%if session['usertype'] == 1%}
<h2> Carrello di {{session['username']}} id = {{session['idord']}}!</h2>
{%else%}
<h2> Carrello</h2>
{%endif%}
{%if libri%}
{%set tot = namespace(prezzo=0, punti=0, quant = 1)%}
{%for libro in libri%}
{%if session['usertype']== 1%}
    {%set tot.quant=libro.rel_quant%}
{%else%}
    {%set tot.quant=session['carrello'][libro.isbn]%}
{%endif%}
    <div class="listalibro">
        <div class="holdcop">
            {%if libro['immagine'] %}
            <img class="copertina" src="{{url_for('static', filename='copertine/'+libro['immagine'])}}" class="copertina"/>
            {%endif%}
        </div>
        <div class ="middle">
            <span class="definizionelista titololista">{{libro.titolo}}</span><br>
            <span class="definizionelista">{{libro.nomeaut}}</span><br>
            <span class="definizionelista">{{libro.nomeedit}}</span>
        </div>
        <div class ="buttonkeeper">
            <span class="definizionelista "> # {{tot.quant}}</span><br>
            <span class="definizionelista">€{{libro.prezzo}} - {{libro.punti}} punti</span><br>
            <button class="menubutton right" onclick="eliminalibrocarr({{libro.isbn}})">Rimuovi</button>
            <a href="/libro/{{libro.isbn}}" class="menubutton right">Visualizza</a>
            
        </div>
    </div>
{%set tot.prezzo = tot.prezzo+(libro.prezzo|float*tot.quant|float)%}
{%set tot.punti = tot.punti|int+(libro.punti|int*tot.quant|int)%}
{%endfor%}
<div class="rigatotale stickbottom" >
<a href="/acquista"class="menubutton right ">Acquista</a>
<span class="deftotale">Totale: €{{tot.prezzo}} - Totale punti: {{tot.punti}}</span>
</div>
{%else%}
<span class="definizionelista titololista">carrello vuoto</span>
{%endif%}
{% endblock %}